-- ============================

-- This file was created using Derby's dblook utility.
-- Timestamp: 2010-05-31 23:46:33.642
-- Source database is: /home/guil/Developpement/Quotes/test/PiggyMarketSqueak/derby/piggymarketsqueak
-- Connection URL is: jdbc:derby:/home/guil/Developpement/Quotes/test/PiggyMarketSqueak/derby/piggymarketsqueak
-- appendLogs: false

-- ----------------------------------------------
-- DDL Statements for tables
-- ----------------------------------------------

CREATE TABLE "APP"."SHARES" ("SYMBOL" VARCHAR(20) NOT NULL, "ISIN" VARCHAR(20) NOT NULL, "NAME" VARCHAR(100) NOT NULL, "LASTQUOTE" DATE NOT NULL, "REMOVABLE" SMALLINT NOT NULL DEFAULT 0, "QUOTATIONPROVIDER" VARCHAR(32), "MARKETLISTPROVIDER" VARCHAR(32), "CATEGORY" VARCHAR(255), "SECTOR_HINT" VARCHAR(64), "TRADING_MODE" VARCHAR(64) NOT NULL DEFAULT 'UNKNOWN', "CAPITALISATION" BIGINT NOT NULL DEFAULT 0);

CREATE TABLE "APP"."ALERTS_ALERTS" ("ID" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1), "ALERTTYPE" VARCHAR(255), "OPTIONALMESSAGE" VARCHAR(255), "VALUE" NUMERIC(19,2), "ALERTS_ID" INTEGER);

CREATE TABLE "APP"."EVENTS" ("SYMBOL" CHAR(13) NOT NULL, "DATE" DATE NOT NULL, "EVENTDEF" CHAR(100), "EVENTTYPE" CHAR(1), "ACCURACY" SMALLINT, "EVENTDEFID" SMALLINT NOT NULL, "ISIN" CHAR(12) NOT NULL, "MESSAGE" VARCHAR(100) DEFAULT '', "ANALYSENAME" VARCHAR(100) NOT NULL DEFAULT 'AutoPortfolio');

CREATE TABLE "APP"."QUOTATIONS" ("DATE" DATE NOT NULL, "SYMBOL" CHAR(13) NOT NULL, "OPENVALUE" DOUBLE DEFAULT 0, "CLOSEVALUE" DOUBLE DEFAULT 0.0, "HIGH" DOUBLE DEFAULT 0.0, "LOW" DOUBLE DEFAULT 0.0, "ISIN" CHAR(12) NOT NULL, "CURRENCY" CHAR(3), "VOLUME" BIGINT DEFAULT 0);

CREATE TABLE "APP"."TREND_SUPPLEMENT" ("SYMBOL" VARCHAR(20) NOT NULL, "ISIN" VARCHAR(20) NOT NULL, "BOURSOMEANRECOMMENDATIONS" NUMERIC(19,2), "BOURSOTARGETPRICE" NUMERIC(19,2), "YAHOOMEANRECOMMENDATIONS" NUMERIC(19,2), "YAHOOTARGETPRICE" NUMERIC(19,2), "DIVIDEND" DECIMAL(10,2) DEFAULT 0, "YAHOOFORWARDPE" NUMERIC(19,2) DEFAULT 0, "YAHOOEPSGROWTH" NUMERIC(19,2) DEFAULT 0, "REUTERSPE" NUMERIC(19,2) DEFAULT 0, "REUTERSPAYOUTRATIO" NUMERIC(19,2) DEFAULT 0, "REUTERSLTGROWTH" NUMERIC(19,2) DEFAULT 0, "BOURSOBNAGROWTH" NUMERIC(19,2) DEFAULT 0, "BOURSOFORWARDPE" NUMERIC(19,2) DEFAULT 0, "YAHOOEPS" NUMERIC(19,2) DEFAULT 0);

CREATE TABLE "APP"."ALERTS" ("ID" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1), "THRESHOLDTYPE" VARCHAR(255), "PORTFOLIOSHARE_ID" INTEGER);

CREATE TABLE "APP"."PORTFOLIO_NAME" ("NAME" VARCHAR(255) NOT NULL, "TYPE" VARCHAR(32) DEFAULT 'default', "TOTALINAMOUNTEVER" NUMERIC(19,2) DEFAULT 0, "TOTALOUTAMOUNTEVER" NUMERIC(19,2) DEFAULT 0);

CREATE TABLE "APP"."CURRENCYRATE" ("FROMCURRENCY" INTEGER NOT NULL, "TOCURRENCY" INTEGER NOT NULL, "DATE" DATE NOT NULL, "RATE" NUMERIC(19,2));

CREATE TABLE "APP"."PORTFOLIO" ("ID" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 71, INCREMENT BY 1), "SYMBOL" VARCHAR(20) NOT NULL, "ISIN" VARCHAR(20) NOT NULL, "QUANTITY" DOUBLE NOT NULL, "CASHIN" DOUBLE NOT NULL, "CASHOUT" DOUBLE DEFAULT 0, "NAME" VARCHAR(255) NOT NULL, "MONITOR" SMALLINT NOT NULL DEFAULT 0, "BUYDATE" DATE DEFAULT '01/01/1970', "AVGBUYPRICE" DECIMAL(9,2) DEFAULT 0, "TRANSACTIONCURRENCY" CHAR(3) NOT NULL DEFAULT 'EUR');

-- ----------------------------------------------
-- DDL Statements for indexes
-- ----------------------------------------------

CREATE INDEX "APP"."PORTFOLIO_SYMBOL" ON "APP"."PORTFOLIO" ("SYMBOL");

CREATE INDEX "APP"."EVENTS_ANALYSENAME_INDEX" ON "APP"."EVENTS" ("ANALYSENAME");

CREATE INDEX "APP"."EVENTS_ANALYSENAME_DATE" ON "APP"."EVENTS" ("ANALYSENAME", "DATE");

CREATE INDEX "APP"."SYMBOL_ISIN_DATE_INDEX" ON "APP"."QUOTATIONS" ("SYMBOL", "ISIN", "DATE");

CREATE INDEX "APP"."SYMBOL_ISIN_INDEX" ON "APP"."QUOTATIONS" ("SYMBOL", "ISIN");

CREATE INDEX "APP"."SHARES_SYMBOL" ON "APP"."SHARES" ("SYMBOL");

-- ----------------------------------------------
-- DDL Statements for keys
-- ----------------------------------------------

-- primary/unique
ALTER TABLE "APP"."TREND_SUPPLEMENT" ADD CONSTRAINT "TREND_SUPPLEMENT_PKEY" UNIQUE ("SYMBOL", "ISIN");

ALTER TABLE "APP"."PORTFOLIO_NAME" ADD CONSTRAINT "PORTFOLIO_NAME_PKEY" PRIMARY KEY ("NAME");

ALTER TABLE "APP"."ALERTS_ALERTS" ADD CONSTRAINT "ALERTS_ALERTS_ID_PKEY" PRIMARY KEY ("ID");

ALTER TABLE "APP"."CURRENCYRATE" ADD CONSTRAINT "CURRENCYRATE_PKEY" PRIMARY KEY ("FROMCURRENCY", "TOCURRENCY", "DATE");

ALTER TABLE "APP"."PORTFOLIO" ADD CONSTRAINT "ID_PK" PRIMARY KEY ("ID");

ALTER TABLE "APP"."EVENTS" ADD CONSTRAINT "EVENTS_PKEY" UNIQUE ("DATE", "EVENTDEFID", "ANALYSENAME", "SYMBOL", "ISIN");

ALTER TABLE "APP"."ALERTS" ADD CONSTRAINT "ALERTS_ID_PKEY" PRIMARY KEY ("ID");

ALTER TABLE "APP"."SHARES" ADD CONSTRAINT "SHARES_SYMBOL_ISIN" UNIQUE ("SYMBOL", "ISIN");

-- foreign
ALTER TABLE "APP"."TREND_SUPPLEMENT" ADD CONSTRAINT "FK_TREND_SUPPLEMENT_TO_SHARES" FOREIGN KEY ("SYMBOL", "ISIN") REFERENCES "APP"."SHARES" ("SYMBOL", "ISIN") ON DELETE NO ACTION ON UPDATE RESTRICT;

ALTER TABLE "APP"."ALERTS_ALERTS" ADD CONSTRAINT "FK_ALERTS_ALERTS_TO_ALERTS" FOREIGN KEY ("ALERTS_ID") REFERENCES "APP"."ALERTS" ("ID") ON DELETE CASCADE ON UPDATE NO ACTION;

ALTER TABLE "APP"."PORTFOLIO" ADD CONSTRAINT "FK_PORTFOLIO_TO_SHARES" FOREIGN KEY ("SYMBOL", "ISIN") REFERENCES "APP"."SHARES" ("SYMBOL", "ISIN") ON DELETE NO ACTION ON UPDATE RESTRICT;

ALTER TABLE "APP"."PORTFOLIO" ADD CONSTRAINT "FK_PORTFOLIO_TO_PORTFOLIO_NAME" FOREIGN KEY ("NAME") REFERENCES "APP"."PORTFOLIO_NAME" ("NAME") ON DELETE CASCADE ON UPDATE RESTRICT;

ALTER TABLE "APP"."ALERTS" ADD CONSTRAINT "FK_ALERTS_TO_PORTFOLIO" FOREIGN KEY ("PORTFOLIOSHARE_ID") REFERENCES "APP"."PORTFOLIO" ("ID") ON DELETE CASCADE ON UPDATE NO ACTION;

